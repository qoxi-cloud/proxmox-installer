# Fail2Ban jail configuration for Proxmox VE 8+
# Generated by Qoxi Proxmox Installer
# Based on: https://pve.proxmox.com/wiki/Fail2ban

[DEFAULT]
# Ban duration: 1 hour (3600 seconds)
bantime = 1h

# Time window for counting failures: 1 day
# (brute-force attacks often try once every few minutes)
findtime = 1d

# Number of failures before ban
maxretry = 5

# Action to take: ban IP using nftables
banaction = nftables-multiport

# Incremental ban times (1h -> 1d -> 2d -> 4d -> ...)
bantime.increment = true
bantime.factor = 24
bantime.maxtime = 30d

# Ignore localhost, private networks, and Tailscale CGNAT range
ignoreip = 127.0.0.1/8 ::1 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16 100.64.0.0/10

# Backend for log monitoring (systemd for Debian 12+)
backend = systemd

[sshd]
enabled = true
port = ssh
filter = sshd
maxretry = 3
findtime = 1d
bantime = 1h

[proxmox]
enabled = true
port = https,http
filter = proxmox
backend = systemd
maxretry = 3
findtime = 1d
bantime = 2h

[recidive]
enabled = true
logpath = /var/log/fail2ban.log
filter = recidive
# Ban if banned 3+ times within 1 week
maxretry = 3
findtime = 1w
# Ban for 2 weeks on recidive
bantime = 2w
# Block all ports for repeat offenders
banaction = nftables-allports
