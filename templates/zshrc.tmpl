# Proxmox ZSH Configuration with Oh-My-Zsh and gentoo theme

# UTF-8 Locale (required for btop and other apps)
export LANG={{LOCALE}}
export LC_ALL={{LOCALE}}
export LANGUAGE={{LOCALE}}

# Ensure sbin dirs in PATH (Debian doesn't include by default)
export PATH="/usr/local/sbin:/usr/sbin:/sbin:$PATH"

# Path to oh-my-zsh installation
export ZSH="$HOME/.oh-my-zsh"

# Set theme to gentoo
ZSH_THEME="gentoo"

# Oh-My-Zsh plugins
plugins=(
    git
    sudo
    history
    dirhistory
    zsh-autosuggestions
    zsh-syntax-highlighting
)

# Load Oh-My-Zsh
source "$ZSH/oh-my-zsh.sh"

# History settings
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE
setopt SHARE_HISTORY
setopt APPEND_HISTORY

# Key bindings
bindkey -e
bindkey '^[[A' history-search-backward
bindkey '^[[B' history-search-forward
bindkey '^[[H' beginning-of-line
bindkey '^[[F' end-of-line
bindkey '^[[3~' delete-char

# Aliases
alias ll='ls -lah --color=auto'
alias la='ls -A --color=auto'
alias l='ls -CF --color=auto'
alias grep='grep --color=auto'
alias df='df -h'
alias du='du -h'
alias free='free -h'
alias ..='cd ..'
alias ...='cd ../..'

# Proxmox aliases
alias qml='qm list'
alias pctl='pct list'
alias pvesh='pvesh'
alias zpl='zpool list'
alias zst='zpool status'

# Use btop instead of top if available
command -v btop &>/dev/null && alias top='btop'

# Auto-suggestions color (gray)
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=8'

# Run fastfetch on first prompt (deferred via precmd hook)
if [[ -o interactive ]] && command -v fastfetch &>/dev/null; then
    function _run_fastfetch_once() {
        fastfetch
        add-zsh-hook -d precmd _run_fastfetch_once
    }
    autoload -Uz add-zsh-hook
    add-zsh-hook precmd _run_fastfetch_once
fi
